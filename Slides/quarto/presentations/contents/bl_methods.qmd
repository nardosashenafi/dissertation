# Bayesian <span style="font-variant:small-caps;">NeuralPbc</span>

## Deterministic vs Bayesian: Simple Pendulum
<!-- ###################################################################### -->

<br/>

* Nominal model of simple pendulum with desired state $x^* = (q^*, \dot{q}^*) = (0, 0)$
\begin{align*}
    \dot{x} = f(x, u) = \begin{bmatrix}
    \dot{q} \\ 
    \frac{mgl}{I} \sin{(q)}
    \end{bmatrix} + \begin{bmatrix}
    0 \\ u(x) \end{bmatrix}
\end{align*}
* We use energy-shaping control (ESC) as the deterministic controller
\begin{align*}
    u^\theta(q, \dot{q}; \theta^e) = \theta^e_1 \dot{q} + \theta^e_2 \cos{(q)} \dot{q} + \theta^e_3 \dot{q}^3
\end{align*}
* **Objective**: train a Bayesian controller that tracks the trajectory generated by ESC
    + allows us to compare the robustness of the deterministic and Bayesian controllers
    + Bayesian controller is also ESC but the parameters are sampled from a posterior distribution
    
<!-- * Measurement noise: $\epsilon_q = 5 \times 10^{-4}$ rad., $\epsilon_{\dot{q}} = 5 \times 10^{-2}$ rad/s. -->

## Training

::::{.columns}

:::{.column width="50%"}
:::{.fragment fragment-index=0}
* $\phi(x_0, u^\theta, T)$: denotes trajectory generated under the current parameter $\theta$ 
:::
:::

:::{.column width="50%"}

:::{.r-stack}

:::{.fragment .fade-in-then-out fragment-index=0}
:::{.callout-important icon="false" }
## Bayesian Controller
\begin{align*}
    \underset{P(\theta | J)}{\textrm{minimize}} 
    & & \sum_{x_\bot \in \phi_\bot, \; x^\star_\bot \in \phi^\star_\bot} &|\left| x_\bot-x^\star_\bot |\right|   , \\
    \textrm{subject to}
    & & \dot{x} &= f(x, u), \\
    & & u^\theta(q, \dot{q}; \theta) &= \theta_1 \dot{q} + \theta_2 \cos{(q)} \dot{q} + \theta_3 \dot{q}^3, \\
    & & \theta &\sim P(\theta | J).
\end{align*}
:::
:::

:::{.fragment .fade-in-then-out fragment-index=1}
:::{.callout-important icon="false" }
## Bayesian Controller
\begin{align*}
    \underset{P(\theta | J)}{\textrm{minimize}} 
    & & J &= \mathbb{E}_{x_0 \in \mathcal{D}_N}[ \sum_{x_\bot \in \phi_\bot, \; x^\star_\bot \in \phi^\star_\bot} |\left| x_\bot-x^\star_\bot | \right |]  , \\
    \textrm{subject to}
    & & \dot{x} &= f(x, u), \\
    & & u^\theta(q, \dot{q}; \theta) &= \theta_1 \dot{q} + \theta_2 \cos{(q)} \dot{q} + \theta_3 \dot{q}^3, \\
    & & \theta &\sim P(\theta | J).
\end{align*}
:::
<!-- callout-->
:::
<!-- fragment-->

:::{.fragment .fade-in-then-out fragment-index=2}
:::{.callout-important icon="false" .fragment .fade-in fragment-index=1}
## Bayesian Controller
\begin{align*}
    \underset{P(\theta | J)}{\textrm{minimize}} 
    & & J &= \mathbb{E}_{x_0 \in \mathcal{D}_N}[ \sum_{x_\bot \in \phi_\bot, \; x^\star_\bot \in \phi^\star_\bot} |\left| x_\bot-x^\star_\bot | \right |]  , \\
    \textrm{subject to}
    & & \dot{x} &= f(x, u), \\
    & & u^\theta(q, \dot{q}; \theta) &= \theta_1 \dot{q} + \theta_2 \cos{(q)} \dot{q} + \theta_3 \dot{q}^3 \\
    & & p_s &\sim \mathcal{N}(\hat{p}_s, \sigma_p), \\
    & & \theta &\sim P(\theta | J).
\end{align*}
:::
<!-- callout-->
:::
<!-- fragment-->
:::
:::
<!-- column-->
::::

## Energy-shaping control 
![](contents/assets/H.svg){.absolute top=150 right=200 width="700" height="600"}


