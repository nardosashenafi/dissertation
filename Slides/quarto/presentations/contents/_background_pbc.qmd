
# Background {visibility="uncounted"}
<!-- ###################################################################### -->

Passive System Theory and Passivity-Based Control (PBC)


## Dissipativity {auto-animate="true"}
<!-- ###################################################################### -->

A dynamical system

$$
\Sigma: \quad
\begin{cases}
  \dot{x} &= f(x,u) \\
  y &= h(x,u)
\end{cases}
\quad x \in \mathcal{X} \subset \mathbb{R}^{2n}, \, u \in \mathcal{U} \subset \mathbb{R}^{m} 
$$

is __dissipative__ with respect to some supply rate $s$ if there exists a *storage function* $\mathcal{H}: \mathcal{X} \to \mathbb{R}^{+}$ such that

$$
\mathcal{H}\left(  x(t_1) \right) \leq  \mathcal{H}\left(  x(t_0) \right) + \int_{t_0}^{t_1} s(u(t), y(t)) \, \text{d}t
$$

for all $x(t_0) = x_0$, all input $u$, and all $t_1 \geq t_0$


## Dissipativity {auto-animate="true"}

$$
\mathcal{H}\left(  x(t_1) \right) \leq  \mathcal{H}\left(  x(t_0) \right) + \int_{t_0}^{t_1} s(u(t), y(t)) \, \text{d}t
$$

:::: {.callout}
## Dissipation Inequality

::: {.incremental}
- Stored energy at $t_1$ is *at most* equal to stored energy at $t_0$, plus externally supplied energy $s(u,y)$
- No generation of energy, only internal dissipation
- With $s(t) \equiv 0$, trajectories tend towards minimum of $\mathcal{H}$
:::
::::


## Passivity
<!-- ###################################################################### -->

The system $\Sigma$ is __passive__ if it is dissipative with supply rate

$$s = u^\top y.$$

It is __output strictly passive__ if it is dissipative with supply rate

$$s = u^\top y - \delta \lVert y \rVert^2, \; \delta > 0.$$

It is __input strictly passive__ if it is dissipative with supply rate


$$s = u^\top y - \delta \lVert u \rVert^2, \; \delta > 0.$$



## Stability of Passive Systems {auto-animate="true"}
<!-- ###################################################################### -->

$$
\Sigma: \quad
\begin{cases}
  \dot{x} &= f(x,u), && f(0,0) = 0, \\
  y &= h(x,u), && h(0,0) = 0,
\end{cases}
$$


$u^{\top} y \geq \dot{\mathcal{H}} = \frac{\partial\mathcal{H}}{\partial x} f(x,u),\quad \mathcal{H} \geq 0,\quad y \equiv 0 \implies x \equiv 0$

::: {.callout-note icon="false"}
## Lemma (Khalil, 2002)
The origin of $\Sigma$ is: 

- __stable__ if $\Sigma$ is passive,
- __asymptotically stable__ if $\Sigma$ is output strictly passive,
- __globally asymptotically stable__ if $\Sigma$ is output strictly passive and the storage function $\mathcal{H}(x) \to \infty$ as $\lVert x \rVert \to \infty$ (radially unbounded)
:::


::: {.notes}
* Notice that we only require that the function $\mathcal{H}$ be positive semidefinite and not necessarily positive definite as per usual Lyapunov conditions.
* Observability (detectability) ensures LaSalle's theorem works.
:::


## Passive System Example
<!-- ###################################################################### -->

:::: {.columns}

::: {.column width="30%"}
![](contents/assets/passive-system-example.png)
:::

::: {.column width="70%"}
Kirchoff's law

$$
\begin{aligned}
v &= Ri + \frac{1}{C} \int_{0}^{t} i(\tau) \, \text{d}\tau + L \frac{\text{d} i}{\text{d} t} \\
vi - Ri^2 &= \frac{\text{d}}{\text{d} t} \left( 
  \underbrace{\frac{1}{2C} \left( \int_{0}^{t} i(\tau)\, \text{d} \tau \right)^2}_{\mathcal{V}} + 
  \underbrace{\frac{1}{2} Li^2}_{\mathcal{T}}  
\right)
\end{aligned}
$$
:::

::::

Let $\mathcal{H} = \mathcal{V} + \mathcal{T}$, integrate to obtain

$$
\underbrace{\mathcal{H}(t)}_{\textrm{available}} -
\underbrace{\mathcal{H}(0)}_{\textrm{initial}} 
= 
\underbrace{\int_{0}^{t} v(\tau)i(\tau)\, \text{d} \tau}_{\textrm{supplied}} - 
\underbrace{\int_{0}^{t} Ri^2(\tau)\, \text{d} \tau}_{\textrm{dissipated}}
<
\int_{0}^{t} v(\tau) i(\tau) \, \text{d} \tau
$$


## Simple Pendulum {auto-animate="false" auto-animate-easing="ease"}
<!-- ###################################################################### -->

:::: {.callout-note icon="false"}

## Energy Shaping

$H(q,p) = \frac{1}{2} J^{-1} p^2 + mgl (1 - \cos q)$

$$
\begin{bmatrix} \dot{q} \\ \dot{p} \end{bmatrix} = 
\begin{bmatrix} \phantom{-}0 & 1 \\ -1 & 0 \end{bmatrix} 
\begin{bmatrix} \nabla_q H_{\phantom{d}} \\ \nabla_p H_{\phantom{d}} \end{bmatrix} +
\begin{bmatrix} 0 \\ G \end{bmatrix} u_\phantom{di},
\qquad y = \dot{q}
$$

::: {.fragment .fade-in fragment-index=1}
Choose $u = u_{es} + u_{di}$ that transforms system into a passive one  with $x^\star = (q^\star, 0)$
<!-- and $H_d$ satisfying $\dot{H}_{d} \leq y^\top u_{di}$ -->
:::

::: {.fragment .fade-in  fragment-index=2}

$Gu_{es} = \nabla_q H  - \nabla_q H_d , \quad Gu_{di} = -GK_D G^\top \nabla_p H_d$
:::


::: {.r-stack}

::: {.fragment .fade-in-then-out fragment-index=1}
$$
\begin{bmatrix} \dot{q} \\ \dot{p} \end{bmatrix} = 
\begin{bmatrix} \phantom{-}0 & 1 \\ -1 & 0 \end{bmatrix} 
\begin{bmatrix} \nabla_q H_d \\ \nabla_p H_d \end{bmatrix} +
\begin{bmatrix} 0 \\ G \end{bmatrix} u_{di},
\qquad y = \dot{q}
$$
:::

::: {.fragment .fade-in fragment-index=2}

$$
\begin{bmatrix} \dot{q} \\ \dot{p} \end{bmatrix} = 
\begin{bmatrix} \phantom{-}0 & 1 \\ -1 & -G K_D G^\top \end{bmatrix} 
\begin{bmatrix} \nabla_q H_d \\ \nabla_p H_d \end{bmatrix},
\qquad y = \dot{q}
$$

:::

:::

::::


##  Simple Pendulum  {auto-animate="false" auto-animate-easing="ease"}
<!-- ###################################################################### -->

:::: {.callout-tip icon="false"}

## Control Synthesis via PBC

Choose $u = u_{es} + u_{di}$ that transforms system into a passive one with $x^\star =  (q^\star, 0)$

$Gu_{es} = \nabla_q H  - \nabla_q H_d , \quad Gu_{di} = -GK_D G^\top \nabla_p H_d$

$$
\begin{bmatrix} \dot{q} \\ \dot{p} \end{bmatrix} = 
\begin{bmatrix} \phantom{-}0 & 1 \\ -1 & -G K_D G^\top \end{bmatrix} 
\begin{bmatrix} \nabla_q H_d \\ \nabla_p H_d \end{bmatrix},
\qquad y = \dot{q}
$$


::: {.fragment .fade-up}
$H_d(q,p) = \frac{1}{2} J^{-1} p^2 + V_d(q), \quad V_d(q) = \frac{1}{2} K_{P} \left( q - q^\star \right)^2$
:::

<!-- $\dot{H_d} = -\left(  \nabla_p H_d \right)^\top K_D \left(  \nabla_p H_d \right) \leq 0$ -->

::: {.fragment .fade-up}
$\dot{H}_d = -K_D \left( J^{-1} p \right)^2 = y^\top u_{di} \leq 0$
:::

::: {.fragment .fade-up}
$\boxed{u = -mgl\sin(q) - K_P(q - q^\star) - K_D \dot{q}}$
:::

::::

## {background-video="contents/assets/ballbot_youtube_trim_reverse.mp4"}
<!-- ###################################################################### -->

:::: {.r-stack}

::: {.fragment .fade-in fragment-index=0}
<div class="semi-transparent-overlay"></div>
:::

<center>![](contents/assets/Ballbot_Rezero_2010.jpg){.fragment .fade-in-then-out fragment-index=0 height=640}</center>

<center>![](contents/assets/ballbot_schematic.png){.fragment .fade-in-then-semi-out fragment-index=1 width=800}</center>

![](contents/assets/ballbot_derivation_1.png){.fragment .fade-in-then-semi-out .absolute top=200 left=20 width=800 }

![](contents/assets/ballbot_derivation_2.png){.fragment .fade-in-then-semi-out .absolute top=20 right=20 width=800 }

:::{.fragment}
:::

::::

## Our Methods {.smaller transition="fade"}
<!-- ###################################################################### -->

::: {layout="[100,-5,60]" layout-valign="center"}
![](contents/assets/pbc-outline-cross.svg)

&nbsp;

:::


:::: {.fragment fragment-index=1}
::: {layout="[100,-5,60]" layout-valign="center"}
![](contents/assets/pbc-ml-outline.svg)

* Systematic approach
* Performance objective included
* Stability is _intrinsic_
* Model uncertainty considerations possible
:::
::::
